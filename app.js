const akshayDefaultStyles = {

    alignContent: 'normal',
    alignItems: 'normal',
    alignSelf: 'auto',
    alignmentBaseline: 'auto',
    all: '',
    animation: 'none 0s ease 0s 1 normal none running',
    animationDelay: '0s',
    animationDirection: 'normal',
    animationDuration: '0s',
    animationFillMode: 'none',
    animationIterationCount: '1',
    animationName: 'none',
    animationPlayState: 'running',
    animationTimingFunction: 'ease',
    appearance: 'none',
    aspectRatio: 'auto',
    backdropFilter: 'none',
    backfaceVisibility: 'visible',
    background: 'rgba(0, 0, 0, 0) none repeat scroll 0% 0% / auto padding-box border-box',
    backgroundAttachment: 'scroll',
    backgroundBlendMode: 'normal',
    backgroundClip: 'border-box',
    backgroundImage: 'none',
    backgroundRepeat: 'repeat',
    backgroundRepeatX: '',
    backgroundRepeatY: '',
    backgroundSize: 'auto',
    border: '0px none rgb(0, 0, 0)',
    borderRadius: '0px',
    bottom: 'auto',
    boxShadow: 'none',
    boxSizing: 'content-box',
    clear: 'none',
    clip: 'auto',
    clipPath: 'none',
    clipRule: 'nonzero',
    color: 'rgb(0, 0, 0)',

    columnCount: 'auto',
    columnFill: 'balance',
    columnGap: 'normal',
    columnRuleStyle: 'none',
    columnRuleWidth: '0px',
    columnSpan: 'none',
    columnWidth: 'auto',
    columns: 'auto auto',
    contain: 'none',
    content: 'normal',
    contentVisibility: 'visible',
    counterIncrement: 'none',
    counterReset: 'none',
    counterSet: 'none',
    cursor: 'auto',
    cx: '0px',
    cy: '0px',
    d: 'none',
    descentOverride: '',
    direction: 'ltr',
    display: 'block',
    dominantBaseline: 'auto',
    emptyCells: 'show',
    fallback: '',
    fill: 'rgb(0, 0, 0)',
    fillOpacity: '1',
    fillRule: 'nonzero',
    filter: 'none',
    flex: '0 1 auto',
    flexBasis: 'auto',
    flexDirection: 'row',
    flexFlow: 'row nowrap',
    flexGrow: '0',
    flexShrink: '1',
    flexWrap: 'nowrap',
    float: 'none',
    // font: '16px \',Times New Roman\',',
    fontDisplay: '',
    fontFamily: '\',Times New Roman\',',
    fontSize: '16px',
    fontStretch: '100%',
    fontStyle: 'normal',
    fontWeight: '400',
    gap: 'normal',
    grid: 'none / none / none / row / auto / auto',
    gridArea: 'auto / auto / auto / auto',
    gridAutoColumns: 'auto',
    gridAutoFlow: 'row',
    gridAutoRows: 'auto',
    gridColumn: 'auto / auto',
    gridColumnEnd: 'auto',
    gridColumnGap: 'normal',
    gridColumnStart: 'auto',
    gridGap: 'normal normal',
    gridRow: 'auto / auto',
    gridRowEnd: 'auto',
    gridRowGap: 'normal',
    gridRowStart: 'auto',
    gridTemplate: 'none / none / none',
    gridTemplateAreas: 'none',
    gridTemplateColumns: 'none',
    gridTemplateRows: 'none',
    height: '0px',
    imageOrientation: 'from-image',
    imageRendering: 'auto',
    justifyContent: 'normal',
    justifyItems: 'normal',
    justifySelf: 'auto',
    left: 'auto',
    letterSpacing: 'normal',
    lightingColor: 'rgb(255, 255, 255)',
    lineBreak: 'auto',
    lineGapOverride: '',
    lineHeight: 'normal',
    listStyle: 'outside none disc',
    listStyleImage: 'none',
    listStylePosition: 'outside',
    listStyleType: 'disc',
    margin: '0px',
    marker: 'none',
    markerEnd: 'none',
    markerMid: 'none',
    markerStart: 'none',
    mask: 'none',
    maskType: 'luminance',

    maxHeight: 'none',

    maxWidth: 'none',
    maxZoom: '',
    minHeight: '0px',

    minWidth: '0px',
    minZoom: '',
    mixBlendMode: 'normal',
    offset: 'none 0px auto 0deg',
    offsetDistance: '0px',
    offsetPath: 'none',
    offsetRotate: 'auto 0deg',
    opacity: '1',
    order: '0',
    orientation: '',
    orphans: '2',
    outline: 'rgb(0, 0, 0) none 0px',
    overflow: 'visible',
    overflowAnchor: 'auto',
    overflowClipMargin: '0px',
    overflowWrap: 'normal',
    overflowX: 'visible',
    overflowY: 'visible',
    overrideColors: '',
    overscrollBehavior: 'auto',
    overscrollBehaviorBlock: 'auto',
    overscrollBehaviorInline: 'auto',
    overscrollBehaviorX: 'auto',
    overscrollBehaviorY: 'auto',
    padding: '0px',
    pageOrientation: '',
    pointerEvents: 'auto',
    position: 'static',

    r: '0px',
    range: '',
    resize: 'none',
    right: 'auto',
    rotate: 'none',
    rowGap: 'normal',
    rx: 'auto',
    ry: 'auto',
    scale: 'none',
    scrollBehavior: 'auto',
    scrollMargin: '0px',
    scrollMarginBlock: '0px',
    scrollMarginBlockEnd: '0px',
    scrollMarginBlockStart: '0px',
    scrollMarginBottom: '0px',
    scrollMarginInline: '0px',
    scrollMarginInlineEnd: '0px',
    scrollMarginInlineStart: '0px',
    scrollMarginLeft: '0px',
    scrollMarginRight: '0px',
    scrollMarginTop: '0px',
    scrollPadding: 'auto',
    scrollPaddingBlock: 'auto',
    scrollPaddingBlockEnd: 'auto',
    scrollPaddingBlockStart: 'auto',
    scrollPaddingBottom: 'auto',
    scrollPaddingInline: 'auto',
    scrollPaddingInlineEnd: 'auto',
    scrollPaddingInlineStart: 'auto',
    scrollPaddingLeft: 'auto',
    scrollPaddingRight: 'auto',
    scrollPaddingTop: 'auto',
    scrollSnapAlign: 'none',
    scrollSnapStop: 'normal',
    scrollSnapType: 'none',
    scrollbarGutter: 'auto',
    shapeImageThreshold: '0',
    shapeMargin: '0px',
    shapeOutside: 'none',
    shapeRendering: 'auto',
    size: '',
    src: '',
    stopColor: 'rgb(0, 0, 0)',
    stopOpacity: '1',
    stroke: 'none',
    strokeOpacity: '1',
    strokeWidth: '1px',
    suffix: '',
    symbols: '',
    syntax: '',
    system: '',
    tabSize: '8',
    tableLayout: 'auto',
    textAlign: 'start',
    textAlignLast: 'auto',
    textAnchor: 'start',
    textCombineUpright: 'none',
    textDecoration: 'none solid rgb(0, 0, 0)',
    textIndent: '0px',
    textOrientation: 'mixed',
    textOverflow: 'clip',
    textShadow: 'none',
    textTransform: 'none',
    top: 'auto',
    transform: 'none',
    transition: 'all 0s ease 0s',
    transitionDelay: '0s',
    transitionDuration: '0s',
    transitionProperty: 'all',
    transitionTimingFunction: 'ease',
    translate: 'none',
    userZoom: '',
    verticalAlign: 'baseline',
    visibility: 'visible',
    whiteSpace: 'normal',
    width: '0px',
    wordBreak: 'normal',
    wordSpacing: '0px',
    wordWrap: 'normal',
    x: '0px',
    y: '0px',
    zIndex: 'auto',
    zoom: '1',
}




function createUniqueSelector(element) {
    const attributes = element.getAttributeNames()
    let selector = `${element.tagName.toLowerCase()}`
    for (let attr of attributes) {
        if (attr === 'class') {
            let classNames = element.getAttribute(attr).split(" ")
            for (let className of classNames) {
                selector += `.${className}`
            }
        }
    }
    return selector
}

function normalizeCssPropName(name) {
    let s = ""
    let s1 = name.toLowerCase()
    for (let x = 0; x < name.length; x++) {
        if (s1[x].toUpperCase() === name[x]) {

            s += "-" + s1[x]
        } else {
            s += s1[x]
        }
    }
    return s
}

function cssPropsToHTML(cssProps) {
    const propertiesToHighlight = ['background-color', 'background', 'color', 'font-size']
    let propertyColor = 'rgb(3, 218, 198)'
    let valueColor = 'white'
    let h = ""
    for (let prop in cssProps) {
        let normalizedName = normalizeCssPropName(prop)
        h += `
            <div style='margin: 1px 5px;'><span style='color : ${propertyColor};'>${normalizedName}</span> : <span style='color : ${valueColor};'>${cssProps[prop]} ;<span></div>`

    }
    return h
}

function stringifyCSS(cssProps) {
    let allProps = cssProps
    let s = "{\n"
    for (let prop in allProps) {
        s += `  ${normalizeCssPropName(prop)} : ${allProps[prop]};\n`
    }
    return s + "}\n"
}

function createCssCodeContainer() {
    const body = document.querySelector('body')
    body.style.position = 'relative'
    const div = document.createElement("div")
    div.setAttribute("class", 'icss-container icss-excluded')
    const divStyle = `
    font-size : 13px;
    font-family : monospace !important;
    position : fixed;
    z-index : 100000;
    display : none;
    background-color : rgb(33, 37, 41);
    border-radius : 10px;
    color : white;
    padding : 10px;
    font-weight : 500;
    border : 1px solid white;
    letter-spacing : 1px;
    line-height : 15px;
    width : 400px;
    overflow-y : scroll;
    height : 400px;
    overflow-wrap : 'break-word;
    `
    div.style.cssText = divStyle
    const code = document.createElement("div")
    code.setAttribute('class', 'language-html icss-code-wrap icss-excluded')
    const codeStyle = `
    overflow : hidden;
    line-height : 1.5rem !important;
    letter-spacing : 1px !important;
    overflow-wrap : 'break-word;
    font-family : monospace !important;
    z-index : 100000;
    `

    code.style.cssText = codeStyle
    code.textContent = "Start Inspecting"
    div.appendChild(code)
    body.appendChild(div)
}



function mouseOverListener(event) {
    event.preventDefault()
    event.stopPropagation();
    elementOnTarget = event.target
    if (!event.target.classList.contains("icss-excluded")) {
        oldBorderProperty = event.target.style.border

        let uniqueSelector = createUniqueSelector(event.target)
        let computedProps = getCssProps(event.target)
        document.querySelector(".icss-code-wrap").innerHTML = `<span style='color:rgb(255, 90, 95);'>${uniqueSelector}</span><br>${cssPropsToHTML(computedProps)}`
        // event.target.style.border = "2px red dotted"
        event.target.style.outline = "2px red solid"
    }
}


function mouseOutListener(event) {
    event.stopPropagation();
    // event.target.style.border = oldBorderProperty
    event.target.style.outline = "none"
}



function mouseMoveListener(event) {
    const cssCodeContainer = document.querySelector(".icss-container")
    let xPos = event.clientX
    let yPos = event.clientY
    let screenWidth = screen.width
    let sceenHeight = screen.height
    if (screenWidth - xPos > 450) {
        cssCodeContainer.style.left = `${xPos + 20}px`

    } else {
        cssCodeContainer.style.left = `${xPos - 450}px`
    }

    if (sceenHeight - yPos > 400) {
        cssCodeContainer.style.top = `${yPos + 20}px`
    } else {
        cssCodeContainer.style.top = `${yPos - 400}px`
    }

}




function clickListener(event) {
    event.preventDefault()
    event.stopPropagation();
    let uniqueParentSelector = createUniqueSelector(event.target)
    let parentProps = getCssProps(event.target)

    let children = document.querySelectorAll(`${uniqueParentSelector} *`)
    let allProps = {}
    allProps[uniqueParentSelector] = parentProps
    let codeToCopy = ""
    children.forEach(child => {
        let childSelector = createUniqueSelector(child)
        let childProps = getCssProps(child)
        allProps[childSelector] = childProps
    })
    for (prop in allProps) {
        codeToCopy += `${prop} ${stringifyCSS(allProps[prop])}\n`
    }
    navigator.clipboard.writeText(codeToCopy)
}

function getCssProps(element) {
    const computedProps = {}
    const computedStyles = window.getComputedStyle(element)
    for (let key in computedStyles) {
        if (key in akshayDefaultStyles && computedStyles[key] !== akshayDefaultStyles[key]) {
            computedProps[key] = computedStyles[key]
        }
    }
    return computedProps
}

function toggleInspection() {
    const cssCodeContainer = document.querySelector(".icss-container")
    if (!isInspectionPaused && inspectionOn) {
        allElements.forEach(element => {
            element.removeEventListener("mouseover", mouseOverListener)
            element.removeEventListener("mouseout", mouseOutListener)
            element.removeEventListener("mousemove", mouseMoveListener)
        })
        isInspectionPaused = true
    }
    else {
        cssCodeContainer.scrollTop = 0
        allElements.forEach(element => {
            element.style.outline = 'none'
            element.addEventListener("mouseover", mouseOverListener)
            element.addEventListener("mouseout", mouseOutListener)
            element.addEventListener("mousemove", mouseMoveListener)
        })
        isInspectionPaused = false
    }
}

function turnOnInspection() {
    const cssCodeContainer = document.querySelector(".icss-container")
    allElements.forEach(element => {
        element.addEventListener("mouseover", mouseOverListener)
        element.addEventListener("mouseout", mouseOutListener)
        // element.addEventListener("click", clickListener)
        element.addEventListener("mousemove", mouseMoveListener)

    })
    cssCodeContainer.style.display = 'block'
    inspectionOn = true
}
function keyFunctions() {
    allElements.forEach(element => {
        element.addEventListener("keydown", (event) => {
            event.preventDefault()
            event.stopPropagation()

            if (event.keyCode === 80 && inspectionOn) {
                toggleInspection()
            }

            if (event.keyCode === 65 && inspectionOn ) {
                let element = elementOnTarget
                let uniqueParentSelector = createUniqueSelector(element)
                let parentProps = getCssProps(element)

                let children = document.querySelectorAll(`${uniqueParentSelector} *`)
                let allProps = {}
                allProps[uniqueParentSelector] = parentProps
                let codeToCopy = ""
                children.forEach(child => {
                    let childSelector = createUniqueSelector(child)
                    let childProps = getCssProps(child)
                    allProps[childSelector] = childProps
                })
                for (prop in allProps) {
                    codeToCopy += `${prop} ${stringifyCSS(allProps[prop])}\n`
                }
                navigator.clipboard.writeText(codeToCopy)
            }
            if (event.keyCode === 67 && inspectionOn) {
                let element = elementOnTarget
                let uniqueParentSelector = createUniqueSelector(element)
                let parentProps = getCssProps(element)
                let codeToCopy = `${uniqueParentSelector} ${stringifyCSS(parentProps)}`
                navigator.clipboard.writeText(codeToCopy)
            }
            if (event.altKey && event.keyCode === 83) {
                if (inspectionOn) {
                    turnOffInspection()
                }
                else {
                    turnOnInspection()
                }
            }
        })
    })

}

function turnOffInspection() {
    const cssCodeContainer = document.querySelector(".icss-container")
    allElements.forEach(element => {
        element.removeEventListener("mouseover", mouseOverListener)
        element.removeEventListener("mouseout", mouseOutListener)
        // element.removeEventListener("click", clickListener)
        element.removeEventListener("mousemove", mouseMoveListener)
        element.style.outline = 'none'
    })
    cssCodeContainer.style.display = 'none'

    inspectionOn = false
}

const allElements = document.querySelectorAll("*:not(.icss-excluded)")
let inspectionOn = false
let isInspectionPaused = false
let oldBorderProperty = ''
let elementOnTarget
createCssCodeContainer()
keyFunctions()








